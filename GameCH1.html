<!DOCTYPE HTML>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>SlimeCH1</title>
    <script type="text/javascript" src="simpleGame.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
        }

        canvas {
            display: block;
        }
    </style>
    <script type="text/javascript">
        var game;
        var background;
        var character;
        var wallBushes = [];
        var berryBush;
        var timer;
        var timeLeft = 20;
        var timerDisplay;



        function init() {
    game = new Scene();
    game.setSize(1000, 700);

    background = new Sprite(game, "grass.png", 1000, 700);
    background.setSpeed(0, 0);
    background.setPosition(500, 350);

    character = new Sprite(game, "Slime1_Walk_body.png", 64, 64);
    character.loadAnimation(512, 256, 64, 64);
    character.generateAnimationCycles();
    character.renameCycles(["down", "up", "left", "right"]);
    character.setAnimationSpeed(500);
    character.setPosition(500, 50);
    character.setSpeed(0);
    character.pauseAnimation();
    character.setCurrentCycle("down");

    createWallBushes();
    createBerryBush();
    createTimerDisplay();
    startTimer();
    game.start();
}

function createTimerDisplay() {
    timerDisplay = document.createElement("div");
    timerDisplay.style = "position:absolute; top:10px; left:10px; padding:10px; background:white; font-size:20px; font-weight:bold;";
    document.body.appendChild(timerDisplay);
    updateTimerDisplay();
}


function startTimer() {
    timer = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
            gameOver("Time's up! Try again?");
        }
    }, 1000);
}
function updateTimerDisplay() {
    timerDisplay.innerText = `Time: ${timeLeft}s`;
}

function checkCollision() {
    for (let bush of wallBushes) {
        if (character.collidesWith(bush)) {
            gameOver("You hit a bush! Try again?");
        }
    }
    if (character.collidesWith(berryBush)) {
        gameWin();
    }
}

function gameOver(message) {
    clearInterval(timer);
    alert(message);
    location.reload();
}
function gameWin() {
    clearInterval(timer);
    let winPopup = confirm("You win! Play again or continue?");
    if (winPopup) {
        location.reload();
    } else {
        alert("Next game coming soon!");
    }
}

        function createBerryBush() {
            let bushWidth = 163;
            let bushHeight = 153;

            // กำหนดเมทริกซ์ตำแหน่งของพุ่ม Berry (มีแค่จุดเดียว)
            let berryBushMatrix = [
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 1, 0, 0, 0]  // พุ่ม Berry อยู่ที่ row 3, col 5
            ];

            for (let row = 0; row < berryBushMatrix.length; row++) {
                for (let col = 0; col < berryBushMatrix[row].length; col++) {
                    if (berryBushMatrix[row][col] === 1) {
                        let x = col * bushWidth + (bushWidth / 2);
                        let y = row * bushHeight + (bushHeight / 2);

                        berryBush = new Sprite(game, "SpriteBerryBush.png", 979, 153);
                        berryBush.loadAnimation(979, 153, 163, 153);
                        berryBush.generateAnimationCycles(SINGLE_ROW, 6);
                        berryBush.setAnimationSpeed(700);
                        berryBush.setSpeed(0);
                        berryBush.setPosition(x, y);
                        berryBush.playAnimation();
                    }
                }
            }
        }

        function createWallBushes() {
            let bushWidth = 163;  // ความกว้างของพุ่มไม้แต่ละอัน
            let bushHeight = 153; // ความสูงของพุ่มไม้แต่ละอัน

            // กำหนดเมทริกซ์พุ่มไม้ (1 = มีพุ่มไม้, 0 = ไม่มี)
            let bushMatrix = [
                [0, 0, 0, 0, 0, 0, 0],
                [1, 1, 1, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 1, 1, 0, 1, 1]
            ];

            for (let row = 0; row < bushMatrix.length; row++) {
                for (let col = 0; col < bushMatrix[row].length; col++) {
                    if (bushMatrix[row][col] === 1) { // สร้างพุ่มไม้เฉพาะจุดที่เป็น 1
                        let x = col * bushWidth + (bushWidth / 2);
                        let y = row * bushHeight + (bushHeight / 2);

                        let bush = new Sprite(game, "SpriteWallBush.png", 979, 153);
                        bush.loadAnimation(979, 153, 163, 153);
                        bush.generateAnimationCycles(SINGLE_ROW, 6);
                        bush.setAnimationSpeed(700);
                        bush.setPosition(x, y);
                        bush.playAnimation();
                        wallBushes.push(bush);
                    }
                }
            }
        }

        function update() {
            game.clear();
            checkKeys();
            background.update();
            character.update();
            checkCollision();

            for (let bush of wallBushes) {
                bush.update();
            }
            if (berryBush) {
                berryBush.update();
            }
        }


        function checkKeys() {
            if (keysDown[K_LEFT]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(270);
                character.setCurrentCycle("left");
            } else if (keysDown[K_RIGHT]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(90);
                character.setCurrentCycle("right");
            } else if (keysDown[K_UP]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(0);
                character.setCurrentCycle("up");
            } else if (keysDown[K_DOWN]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(180);
                character.setCurrentCycle("down");
            } else if (keysDown[K_SPACE]) {
                character.setSpeed(0);
                character.pauseAnimation();
                character.setCurrentCycle("down");
            } else {
                character.setSpeed(0);
            }
        }

        window.onresize = function () {
            let newWidth = window.innerWidth;
            let newHeight = window.innerHeight;
            game.setSize(newWidth, newHeight);
            background.setPosition(newWidth / 2, newHeight / 2);
            character.setPosition(newWidth / 2, newHeight / 2);
        };

    </script>
</head>

<body onload="init()">
</body>

</html>