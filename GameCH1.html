<!DOCTYPE HTML>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>SlimeCH1</title>
    <script type="text/javascript" src="simpleGame.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
        }

        canvas {
            display: block;
        }
    </style>
    <script type="text/javascript">
        var game;
        var background;
        var character;
        var wallBushes = [];
        var berryBush;
        var timer;
        var timeLeft = 20;
        var timerDisplay;



        function init() {
            game = new Scene();
            game.setSize(1000, 700);

            background = new Sprite(game, "grass.png", 1000, 700);
            background.setSpeed(0, 0);
            background.setPosition(500, 350);

            character = new Sprite(game, "Slime1_Walk_body.png", 64, 64);
            character.loadAnimation(512, 256, 64, 64);
            character.generateAnimationCycles();
            character.renameCycles(["down", "up", "left", "right"]);
            character.setAnimationSpeed(500);
            character.setPosition(500, 50);
            character.setSpeed(0);
            character.pauseAnimation();
            character.setCurrentCycle("down");
            character.setBoundAction(STOP);

            createWallBushes();
            createBerryBush();
            createTimerDisplay();
            startTimer();
            game.start();
        }

        function createTimerDisplay() {
            timerDisplay = document.createElement("div");
            timerDisplay.style = "position:absolute; top:10px; left:10px; padding:10px; background:white; font-size:20px; font-weight:bold;";
            document.body.appendChild(timerDisplay);
            updateTimerDisplay();
        }


        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    gameOver("Time's up! Try again?");
                }
            }, 1000);
        }
        function updateTimerDisplay() {
            timerDisplay.innerText = `Time: ${timeLeft}s`;
        }

        function createCard(title, buttons) {
            // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            let oldCard = document.getElementById("gameCard");
            if (oldCard) oldCard.remove();

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà
            let card = document.createElement("div");
            card.id = "gameCard";
            card.style = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        padding: 20px;
        background: white;
        text-align: center;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
        z-index: 1000;
    `;

            let titleText = document.createElement("h2");
            titleText.innerText = title;
            card.appendChild(titleText);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á ‡πÜ
            buttons.forEach(btnData => {
                let button = document.createElement("button");
                button.innerText = btnData.text;
                button.onclick = btnData.onClick;
                button.style = `
            margin: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            background: ${btnData.color};
            color: white;
        `;
                card.appendChild(button);
            });

            document.body.appendChild(card);
        }

        function checkCollision() {
            let charLeft = character.x - character.width / 2;
            let charRight = character.x + character.width / 2;
            let charTop = character.y - character.height / 2;
            let charBottom = character.y + character.height / 2;

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏Å‡∏±‡∏ö‡∏û‡∏∏‡πà‡∏°‡πÑ‡∏°‡πâ
            for (let bush of wallBushes) {
                let bushLeft = bush.x - bush.width / 2;
                let bushRight = bush.x + bush.width / 2;
                let bushTop = bush.y - bush.height / 2;
                let bushBottom = bush.y + bush.height / 2;

                let buffer = 30; // ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï hitbox ‡∏Ç‡∏≠‡∏á‡∏û‡∏∏‡πà‡∏°‡πÑ‡∏°‡πâ‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢

                if (
                    character.x + character.width - buffer > bush.x + buffer &&
                    character.x + buffer < bush.x + bush.width - buffer &&
                    character.y + character.height - buffer > bush.y + buffer &&
                    character.y + buffer < bush.y + bush.height - buffer
                ) {
                    console.log("üí• Collision detected with bush!");
                    gameOver("You hit a bush! Try again?");
                }
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏Å‡∏±‡∏ö BerryBush (‡πÉ‡∏ä‡πâ hitbox ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö wallBush)
            if (berryBush) {
                let berryBushLeft = berryBush.x - berryBush.width / 2;
                let berryBushRight = berryBush.x + berryBush.width / 2;
                let berryBushTop = berryBush.y - berryBush.height / 2;
                let berryBushBottom = berryBush.y + berryBush.height / 2;

                let buffer = 40; // ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï hitbox ‡∏Ç‡∏≠‡∏á berryBush ‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢

                if (
                    charRight - buffer > berryBushLeft + buffer &&
                    charLeft + buffer < berryBushRight - buffer &&
                    charBottom - buffer > berryBushTop + buffer &&
                    charTop + buffer < berryBushBottom - buffer
                ) {
                    console.log("üçá You won! Collision with Berry Bush!");
                    gameWin();
                }
            }

            /* if (charLeft < 0 || charRight > game.width || charTop < 0 || charBottom > game.height) {
                console.log("üöß Out of bounds!");
                gameOver("You hit the screen boundary! Try again?");
            } */
        }




        function gameOver() {
            clearInterval(timer);
            createCard("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß!", [
                { text: "Restart", color: "red", onClick: () => location.reload() }
            ]);
        }

        function gameWin() {
            clearInterval(timer);
            createCard("‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß!", [
                { text: "Restart", color: "green", onClick: () => location.reload() },
                { text: "Next Stage", color: "blue", onClick: () => alert("Next stage coming soon!") }
            ]);
        }

        function createBerryBush() {
            let bushWidth = 163;
            let bushHeight = 153;

            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏∏‡πà‡∏° Berry (‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
            let berryBushMatrix = [
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 1, 0, 0, 0]  // ‡∏û‡∏∏‡πà‡∏° Berry ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà row 3, col 5
            ];

            for (let row = 0; row < berryBushMatrix.length; row++) {
                for (let col = 0; col < berryBushMatrix[row].length; col++) {
                    if (berryBushMatrix[row][col] === 1) {
                        let x = col * bushWidth + (bushWidth / 2);
                        let y = row * bushHeight + (bushHeight / 2);

                        berryBush = new Sprite(game, "SpriteBerryBush.png", 979, 153);
                        berryBush.loadAnimation(979, 153, 163, 153);
                        berryBush.generateAnimationCycles(SINGLE_ROW, 6);
                        berryBush.setAnimationSpeed(700);
                        berryBush.setSpeed(0);
                        berryBush.setPosition(x, y);
                        berryBush.playAnimation();
                    }
                }
            }
        }

        function createWallBushes() {
            let bushWidth = 163;
            let bushHeight = 153;

            // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏∏‡πà‡∏°‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÅ‡∏ó‡∏ô‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå)
            let bushPositions = [
                { x: 0, y: 153 }, { x: 163, y: 153 }, { x: 326, y: 153 }, // Row 1
                { x: 815, y: 306 }, { x: 978, y: 306 }, // Row 2
                { x: 489, y: 459 }, { x: 652, y: 459 }, { x: 815, y: 459 }, { x: 978, y: 459 } // Row 3
            ];

            for (let pos of bushPositions) {
                let bush = new Sprite(game, "SpriteWallBush.png", 163, 153); // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö animation frame
                bush.loadAnimation(979, 153, 163, 153);
                bush.generateAnimationCycles(SINGLE_ROW, 6);
                bush.setAnimationSpeed(700);
                bush.setPosition(pos.x, pos.y);
                bush.playAnimation();
                wallBushes.push(bush);
            }
        }

        function update() {
            game.clear();
            checkKeys();
            background.update();
            character.update();
            checkCollision();

            for (let bush of wallBushes) {
                bush.update();
            }
            if (berryBush) {
                berryBush.update();
            }
        }


        function checkKeys() {
            if (keysDown[K_LEFT]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(270);
                character.setCurrentCycle("left");
            } else if (keysDown[K_RIGHT]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(90);
                character.setCurrentCycle("right");
            } else if (keysDown[K_UP]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(0);
                character.setCurrentCycle("up");
            } else if (keysDown[K_DOWN]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(180);
                character.setCurrentCycle("down");
            } else if (keysDown[K_SPACE]) {
                character.setSpeed(0);
                character.pauseAnimation();
                character.setCurrentCycle("down");
            } else {
                character.setSpeed(0);
            }
        }

        window.onresize = function () {
            let newWidth = window.innerWidth;
            let newHeight = window.innerHeight;
            game.setSize(newWidth, newHeight);
            background.setPosition(newWidth / 2, newHeight / 2);
            character.setPosition(newWidth / 2, newHeight / 2);
        };

    </script>
</head>

<body onload="init()">
</body>

</html>