<!DOCTYPE HTML>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>SlimeCH1</title>
    <script type="text/javascript" src="simpleGame.js"></script>
    <!-- <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            background-color: black;
        }

        canvas {
            display: block;
            max-width: 100%;
            max-height: 100%;
        }
    </style> -->
    <script type="text/javascript">
        var game;
        var background;
        var character;
        var wallBushes = [];
        var berryBush;
        var timer;
        var timeLeft = 20;
        var timerDisplay;
        var gameStarted = false;

        function init() {
            game = new Scene();
            let gameWidth = 1000;  // à¸à¸³à¸«à¸™à¸”à¸‚à¸™à¸²à¸”à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸‚à¸­à¸‡à¹€à¸à¸¡
            let gameHeight = 700;

            game.setSize(gameWidth, gameHeight);
            game.setBG("lightgreen");

            background = new Sprite(game, "BG1.png", gameWidth, gameHeight);
            background.setSpeed(0, 0);
            background.setPosition(gameWidth / 2, gameHeight / 2);

            character = new Sprite(game, "Sprite_Slime_CH1.png", 64, 64);
            character.loadAnimation(512, 256, 64, 64);
            character.generateAnimationCycles();
            character.renameCycles(["down", "up", "left", "right"]);
            character.setAnimationSpeed(500);
            character.setPosition(500, 50);
            character.setSpeed(0);
            character.pauseAnimation();
            character.setCurrentCycle("down");
            character.setBoundAction(STOP);

            createWallBushes();
            createBerryBush();
            createTimerDisplay();
            showInstructions();
        }


        function showInstructions() {
            createCard("Chapter 1 \nà¸§à¸´à¸˜à¸µà¸à¸²à¸£à¹€à¸¥à¹ˆà¸™", [
                { text: "Ready", color: "green", onClick: startGame }
            ], "- à¸šà¸±à¸‡à¸„à¸±à¸š Slime à¸”à¹‰à¸§à¸¢à¸›à¸¸à¹ˆà¸¡à¸¥à¸¹à¸à¸¨à¸£\n- à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸žà¸¸à¹ˆà¸¡à¹„à¸¡à¹‰\n- à¹„à¸›à¸–à¸¶à¸‡à¸žà¸¸à¹ˆà¸¡à¹€à¸šà¸­à¸£à¸µà¹ˆà¸à¹ˆà¸­à¸™à¸«à¸¡à¸”à¹€à¸§à¸¥à¸²\n- à¹€à¸à¹‡à¸šà¸žà¸¸à¹ˆà¸¡à¹€à¸šà¸­à¸£à¸µà¹ˆà¹€à¸žà¸·à¹ˆà¸­à¸Šà¸™à¸°");
        }

        function createTimerDisplay() {
            timerDisplay = document.createElement("div");
            timerDisplay.style = "position:absolute; top:10px; left:10px; padding:10px; background:white; font-size:20px; font-weight:bold;";
            document.body.appendChild(timerDisplay);
            updateTimerDisplay();
        }

        function startGame() {
            gameStarted = true;
            startTimer();
            game.start();
        }

        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    gameOver("Time's up! Try again?");
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            timerDisplay.innerText = `Time: ${timeLeft}s`;
        }

        function createCard(title, buttons, message = "", transparent = false) {
            let oldCard = document.getElementById("gameCard");
            if (oldCard) oldCard.remove();

            let card = document.createElement("div");
            card.id = "gameCard";

            // à¸„à¸³à¸™à¸§à¸“à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸à¸¥à¸²à¸‡à¸‚à¸­à¸‡à¹€à¸à¸¡
            let gameWidth = game.width;  // à¸‚à¸™à¸²à¸”à¸‚à¸­à¸‡ canvas (game)
            let gameHeight = game.height; // à¸‚à¸™à¸²à¸”à¸‚à¸­à¸‡ canvas (game)

            card.style = `
        position: absolute;
        top: ${gameHeight / 2 - 150}px;  /* à¸à¸¥à¸²à¸‡à¸•à¸²à¸¡à¹à¸™à¸§à¸•à¸±à¹‰à¸‡ */
        left: ${gameWidth / 2 - 150}px;  /* à¸à¸¥à¸²à¸‡à¸•à¸²à¸¡à¹à¸™à¸§à¸™à¸­à¸™ */
        width: 300px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.8);
        text-align: center;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
        z-index: 1000;  /* à¹ƒà¸«à¹‰à¸­à¸¢à¸¹à¹ˆà¸”à¹‰à¸²à¸™à¸šà¸™à¸ªà¸¸à¸” */
    `;

            let titleText = document.createElement("h2");
            titleText.innerText = title;
            card.appendChild(titleText);

            if (message) {
                let msgText = document.createElement("p");
                msgText.innerText = message;
                card.appendChild(msgText);
            }

            buttons.forEach(btnData => {
                let button = document.createElement("button");
                button.innerText = btnData.text;
                button.onclick = () => {
                    card.remove();
                    btnData.onClick();
                };
                button.style = `
            margin: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            background: ${btnData.color};
            color: white;
        `;
                card.appendChild(button);
            });

            document.body.appendChild(card);
        }



        function checkCollision() {
            let charLeft = character.x - character.width / 2;
            let charRight = character.x + character.width / 2;
            let charTop = character.y - character.height / 2;
            let charBottom = character.y + character.height / 2;

            // à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸à¸²à¸£à¸Šà¸™à¸à¸±à¸šà¸žà¸¸à¹ˆà¸¡à¹„à¸¡à¹‰
            for (let bush of wallBushes) {
                let bushLeft = bush.x - bush.width / 2;
                let bushRight = bush.x + bush.width / 2;
                let bushTop = bush.y - bush.height / 2;
                let bushBottom = bush.y + bush.height / 2;

                let buffer = 30; // à¸¥à¸”à¸‚à¸™à¸²à¸”à¸‚à¸­à¸šà¹€à¸‚à¸• hitbox à¸‚à¸­à¸‡à¸žà¸¸à¹ˆà¸¡à¹„à¸¡à¹‰à¸¥à¸‡à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢

                if (
                    character.x + character.width - buffer > bush.x + buffer &&
                    character.x + buffer < bush.x + bush.width - buffer &&
                    character.y + character.height - buffer > bush.y + buffer &&
                    character.y + buffer < bush.y + bush.height - buffer
                ) {
                    // à¸¥à¸š console.log à¸­à¸­à¸
                    gameOver("You hit a bush! Try again?");
                }
            }

            // à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸à¸²à¸£à¸Šà¸™à¸à¸±à¸š BerryBush (à¹ƒà¸Šà¹‰ hitbox à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸š wallBush)
            if (berryBush) {
                let berryBushLeft = berryBush.x - berryBush.width / 2;
                let berryBushRight = berryBush.x + berryBush.width / 2;
                let berryBushTop = berryBush.y - berryBush.height / 2;
                let berryBushBottom = berryBush.y + berryBush.height / 2;

                let buffer = 30; // à¸¥à¸”à¸‚à¸™à¸²à¸”à¸‚à¸­à¸šà¹€à¸‚à¸• hitbox à¸‚à¸­à¸‡ berryBush à¸¥à¸‡à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢

                if (
                    charRight - buffer > berryBushLeft + buffer &&
                    charLeft + buffer < berryBushRight - buffer &&
                    charBottom - buffer > berryBushTop + buffer &&
                    charTop + buffer < berryBushBottom - buffer
                ) {
                    // à¸¥à¸š console.log à¸­à¸­à¸
                    gameWin();
                }
            }
        }




        function gameOver() {
            clearInterval(timer);
            createCard("à¸„à¸¸à¸“à¹à¸žà¹‰à¹à¸¥à¹‰à¸§!", [
                { text: "Restart", color: "red", onClick: () => location.reload() }
            ]);
        }

        var gameWon = false;  // à¹€à¸žà¸´à¹ˆà¸¡à¸•à¸±à¸§à¹à¸›à¸£à¸•à¸´à¸”à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°à¸Šà¸™à¸°

        function gameWin() {
            if (gameWon) return;  // à¸–à¹‰à¸²à¹€à¸à¸¡à¸Šà¸™à¸°à¹à¸¥à¹‰à¸§à¹ƒà¸«à¹‰à¹„à¸¡à¹ˆà¸—à¸³à¸­à¸°à¹„à¸£
            gameWon = true;  // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹ƒà¸«à¹‰à¹€à¸à¸¡à¸Šà¸™à¸°à¹à¸¥à¹‰à¸§
            clearInterval(timer);
            setTimeout(() => {
                createCard("à¸„à¸¸à¸“à¸Šà¸™à¸°à¹à¸¥à¹‰à¸§!", [
                    { text: "Restart", color: "red", onClick: restartGame },
                    { text: "Next Stage", color: "blue", onClick: () => window.location.href = "Game1CH2.html" }
                ]);
            }, 50);  // âœ… à¸«à¸™à¹ˆà¸§à¸‡à¹à¸„à¹ˆ 50ms à¹ƒà¸«à¹‰à¹à¸™à¹ˆà¹ƒà¸ˆà¸§à¹ˆà¸² DOM à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¹Œà¸”
        }

        function restartGame() {
            console.log("ðŸ”„ Restart button clicked! Reloading...");
            location.reload();  // à¹ƒà¸Šà¹‰ location.reload() à¸—à¸µà¹ˆà¸™à¸µà¹ˆ
        }


        function createBerryBush() {
            let bushWidth = 163;
            let bushHeight = 153;

            // à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸‚à¸­à¸‡à¸žà¸¸à¹ˆà¸¡à¹€à¸šà¸­à¸£à¸µà¹ˆ (à¹à¸šà¸šà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸šà¸žà¸¸à¹ˆà¸¡à¹„à¸¡à¹‰)
            let berryBushPositions = [
                { x: 500, y: 690 } // à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ à¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸à¹‰à¹„à¸‚à¹„à¸”à¹‰à¸•à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
            ];

            for (let pos of berryBushPositions) {
                berryBush = new Sprite(game, "Sprite_Berry_Bush.png", 979, 153);
                berryBush.loadAnimation(979, 153, 163, 153);
                berryBush.generateAnimationCycles(SINGLE_ROW, 6);
                berryBush.setAnimationSpeed(700);
                berryBush.setSpeed(0);
                berryBush.setPosition(pos.x, pos.y);
                berryBush.playAnimation();
            }
        }


        function createWallBushes() {
            let bushWidth = 163;
            let bushHeight = 153;

            // à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸‚à¸­à¸‡à¸žà¸¸à¹ˆà¸¡à¹„à¸¡à¹‰à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£ (à¹à¸—à¸™à¹€à¸¡à¸—à¸£à¸´à¸à¸‹à¹Œ)
            let bushPositions = [
                { x: 0, y: 153 }, { x: 163, y: 153 }, { x: 326, y: 153 }, // Row 1
                { x: 815, y: 306 }, { x: 978, y: 306 }, // Row 2
                { x: 489, y: 459 }, { x: 652, y: 459 }, { x: 815, y: 459 }, { x: 978, y: 459 } // Row 3
            ];

            for (let pos of bushPositions) {
                let bush = new Sprite(game, "Sprite_Wall_Bush.png", 163, 153); // âœ… à¹ƒà¸Šà¹‰à¸‚à¸™à¸²à¸”à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸š animation frame
                bush.loadAnimation(979, 153, 163, 153);
                bush.generateAnimationCycles(SINGLE_ROW, 6);
                bush.setAnimationSpeed(700);
                bush.setSpeed(10);
                bush.setPosition(pos.x, pos.y);
                bush.playAnimation();
                wallBushes.push(bush);
            }
        }

        function update() {
            game.clear();
            checkKeys();
            background.update();
            character.update();
            checkCollision();

            for (let bush of wallBushes) {
                bush.update();
            }
            if (berryBush) {
                berryBush.update();
            }
        }


        function checkKeys() {
            if (keysDown[K_LEFT]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(270);
                character.setCurrentCycle("left");
            } else if (keysDown[K_RIGHT]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(90);
                character.setCurrentCycle("right");
            } else if (keysDown[K_UP]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(0);
                character.setCurrentCycle("up");
            } else if (keysDown[K_DOWN]) {
                character.setSpeed(10);
                character.playAnimation();
                character.setMoveAngle(180);
                character.setCurrentCycle("down");
            } else if (keysDown[K_SPACE]) {
                character.setSpeed(0);
                character.pauseAnimation();
                character.setCurrentCycle("down");
            } else {
                character.setSpeed(0);
            }
        }

        /* window.onresize = function () {
            let aspectRatio = 1000 / 700; // à¸­à¸±à¸•à¸£à¸²à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£
            let newWidth = window.innerWidth;
            let newHeight = window.innerHeight;
            let scaleFactor = window.devicePixelRatio || 1;
            game.setSize(newWidth * scaleFactor, newHeight * scaleFactor);


            if (newWidth / newHeight > aspectRatio) {
                newWidth = newHeight * aspectRatio;
            } else {
                newHeight = newWidth / aspectRatio;
            }

            game.setSize(newWidth, newHeight);
            background.setSize(newWidth, newHeight); // à¹ƒà¸«à¹‰ background à¸‚à¸¢à¸²à¸¢à¸•à¸²à¸¡
            background.setPosition(newWidth / 2, newHeight / 2);
            character.setPosition(newWidth / 2, newHeight / 2);
        }; */



    </script>
</head>

<body onload="init()">
</body>

</html>